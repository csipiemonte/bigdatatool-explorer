var Constants=Constants||{};Constants.KNOX_BASE_URL="knox/gateway/default",Constants.HDFS_BASE_URL=Constants.KNOX_BASE_URL+"/webhdfs/v1",Constants.HIVE_BASE_URL=Constants.KNOX_BASE_URL+"/templeton/v1/",Constants.HDFS_OPERATIONS={LIST:"LISTSTATUS",OPEN:"OPEN",GETHOMEDIRECTORY:"GETHOMEDIRECTORY"},Constants.HIVE_OPERATIONS={LIST_DATABASE:"ddl/database/?",SINGLE_DATABASE:"ddl/database/{database}?",LIST_TABLES:"ddl/database/{database}/table?",SINGLE_TABLE:"ddl/database/{database}/table/{table}",SINGLE_TABLE_PROPERTIES:"ddl/database/{database}/table/{table}/property",SINGLE_JOB:"jobs/{job}",SYSTEM_WEBHCAT_STATUS:"status",SYSTEM_WEBHCAT_VERSION:"version",SYSTEM_HIVE_VERSION:"version/hive",SYSTEM_HADOOP_VERSION:"version/hadoop",HIVE_QUERY:"hive"},Constants.HIVE_HIERARCHY=["root","databases","tables","columns"],Constants.HIVE_NODE_TYPES={root:{name:"root",icon:"glyphicon glyphicon-hdd icon-root"},database:{name:"database",icon:"icon icon-database"},table:{name:"table",icon:"icon icon-table"},column:{name:"column",icon:"glyphicon glyphicon-option-vertical"}},Constants.Time={},Constants.Time.ONE_MINUTE=6e4,Constants.Time.ONE_HOUR=36e5,Constants.Time.ONE_DAY=864e5,Constants.Time.ONE_MONTH=26784e5,Constants.Time.ONE_YEAR=31536e6;var bigdataExplorerFilter=angular.module("bigdata-explorer.filters",[]);bigdataExplorerFilter.filter("safeNumber",function(){return function(e,t){var a=e;return isNaN(e)||(isNaN(t)&&(t=0),a=e.toFixed(t)),a}}),bigdataExplorerFilter.filter("format_big_number",function(){return function(e){console.log("input",e);var t="";return e&&(e=Number.parseFloat(e),e<1e3?t=e.toFixed(2):e<1e6?t=(e/1e3).toFixed(2)+" <span class='counter-group'>k</span>":e<1e9?t=(e/1e6).toFixed(2)+" <span class='counter-group'>M</span>":e<1e12&&(t=(e/1e9).toFixed(2)+" <span class='counter-group'>B</span>")),(""+t).replace(".",",")}}),bigdataExplorerFilter.filter("format_filesize",function(){return function(e){var t="";return e&&(e=parseInt(e),e<1e3?t=e+" byte":e<1e6?t=(e/1e3).toFixed(1)+" Kb":e<1e9?t=(e/1e6).toFixed(1)+" Mb":e<1e12&&(t=(e/1e9).toFixed(1)+" Gb")),t}}),bigdataExplorerFilter.filter("string_ellipse",function(){return function(e,t,a){return"undefined"!=typeof e&&null!=e||(e=""),isNaN(t)&&(t=10),void 0===a&&(a="..."),e.length<=t||e.length-a.length<=t?e:String(e).substring(0,t-a.length)+a}}),angular.module("bigdata-explorer.plugin",["bigdata-explorer","bigdata-explorer.templates","bigdata-explorer.utils","bigdata-explorer.filters","bigdata-explorer.services","base64"]);var bigdataExplorerTemplatesModule=angular.module("bigdata-explorer.templates",["bigdata-explorer.utils"]),bigdataExplorerModule=angular.module("bigdata-explorer",["bigdata-explorer.templates","bigdata-explorer.services"]),bigdataExplorerServices=bigdataExplorerServices||angular.module("bigdata-explorer.services",[]);bigdataExplorerServices.factory("hdfsService",["$http","$base64",function(e,t){var a={};a.getInfo=function(){return"Direcotry List"};var n=function(t,a){"undefined"==typeof a&&(a="");var n=Constants.HDFS_BASE_URL+a+"?op="+t;return e.get(n)};return a.getPath=function(e){return n(Constants.HDFS_OPERATIONS.LIST,e)},a.previewFile=function(e){var t=Constants.HDFS_OPERATIONS.OPEN+"&length=1000000";return n(t,e)},a.openFile=function(e){var t=Constants.HDFS_OPERATIONS.OPEN;return n(t,e)},a.getHomeDirectory=function(e,t){return n(Constants.HDFS_OPERATIONS.GETHOMEDIRECTORY,null)},a.logout=function(t,a){var n=window.location.href.replace("://","://log:out@");return console.log("url.",n),e.get(n)},a}]),bigdataExplorerServices.factory("hiveService",["$http","$base64",function(e,t){var a={};a.getInfo=function(){return"Database List"};var n=function(t){var a=Constants.HIVE_BASE_URL+t;return console.debug("callHive - url",a),e.get(a)};return a.databaseList=function(){return n(Constants.HIVE_OPERATIONS.LIST_DATABASE)},a.databaseSingle=function(e){return n(Constants.HIVE_OPERATIONS.SINGLE_DATABASE.replace("{database}",e))},a.tableList=function(e){return n(Constants.HIVE_OPERATIONS.LIST_TABLES.replace("{database}",e))},a.tableSingle=function(e,t){return n(Constants.HIVE_OPERATIONS.SINGLE_TABLE.replace("{database}",e).replace("{table}",t))},a.tableSingleProperties=function(e,t){return n(Constants.HIVE_OPERATIONS.SINGLE_TABLE_PROPERTIES.replace("{database}",e).replace("{table}",t))},a.jobSingle=function(e){return n(Constants.HIVE_OPERATIONS.SINGLE_JOB.replace("{job}",e))},a.runQueryPreview=function(t,a){var n="execute="+t+"&statusdir="+a+"&define=mapreduce.job.queuename=produzione&define=hive.cli.print.header=true";return e({url:Constants.HIVE_BASE_URL+Constants.HIVE_OPERATIONS.HIVE_QUERY,dataType:"text",method:"POST",data:n,headers:{"Content-Type":"text/plain"}})},a.systemWebhcatStatus=function(){return n(Constants.HIVE_OPERATIONS.SYSTEM_WEBHCAT_STATUS)},a.systemWebhcatVersion=function(){return n(Constants.HIVE_OPERATIONS.SYSTEM_WEBHCAT_VERSION)},a.systemHiveVersion=function(){return n(Constants.HIVE_OPERATIONS.SYSTEM_HIVE_VERSION)},a.systemHadoopVersion=function(){return n(Constants.HIVE_OPERATIONS.SYSTEM_HADOOP_VERSION)},a.logout=function(t,a){var n=window.location.href.replace("://","://log:out@");return console.log("url.",n),e.get(n)},a}]);var yuccaUtilsModule=angular.module("bigdata-explorer.utils",[]);yuccaUtilsModule.factory("$bigdataExplorerHelpers",[function(){return{attrs:{num:function(e,t,a,n){var l=e;return(isNaN(e)||null==e||""==e||"undefined"!=typeof t&&null!=t&&e<t||"undefined"!=typeof a&&null!=a&&e>a)&&(l=n),l},safe:function(e,t){var a=e;return"undefined"!=typeof e&&null!=e&&""!=e||(a=t),a}},utils:{isEmpty:function(e){return"undefined"==typeof e||null==e},hex2Rgb:function(e){"#"==e.charAt(0)&&(e=e.substring(1,7));var t=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return t+","+a+","+n},formatDateFromMillis:function(e){var t="";if(e){var a=new Date(e),n=a.getDate(),l=a.getMonth()+1,i=a.getFullYear(),s=a.getHours(),o=a.getMinutes();t=""+(n<=9?"0"+n:n)+"/"+(l<=9?"0"+l:l)+"/"+i+" "+(s<=9?"0"+s:s)+":"+(o<=9?"0"+o:o)}return t},lZero:function(e){var t="00";return isNaN(e)||(t=e<=9?"0"+e:e),t},formatData:function(e){var t="";if(e){var a=new Date(e),n=a.getDate(),l=a.getMonth()+1,i=a.getFullYear(),s=a.getHours(),o=a.getMinutes(),r=a.getSeconds();t=""+i+"/"+(l<=9?"0"+l:l)+"/"+(n<=9?"0"+n:n)+" "+(s<=9?"0"+s:s)+":"+(o<=9?"0"+o:o)+":"+(r<=9?"0"+r:r)}return t}},render:{safeTags:function(e){var t="";if("undefined"!=typeof e&&null!=e){var a=typeof e;t="string"==a?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}return t},linkify:function(e){var t="";if("undefined"!=typeof e&&null!=e){var a=typeof e;if("string"==a){var n,l,i;n=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=e.replace(n,'<a href="$1" target="_blank">$1</a>'),l=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(l,'$1<a href="http://$2" target="_blank">$2</a>'),i=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(i,'<a href="mailto:$1">$1</a>')}else t=e}return t}}}}]),bigdataExplorerModule.directive("hdfsExplorer",["hdfsService","$bigdataExplorerHelpers",function(e,t){"use strict";return{restrict:"E",scope:{},templateUrl:"template/hdfs-explorer.html",link:function(t,a,n){console.debug("attrs",n),console.debug("hdfsService",e.getInfo()),t.started=!1;var l=n.startpath;t.pathToBrowse=[],t.copyPanel={pathToCopy:null};var i={fullpath:l,pathSuffix:""};console.log("rootFolder",i),t.filetree={viewId:"root_",pathSuffix:l,children:[],fullpath:n.startpath+"/",loadChildren:function(){t.selectNode(this.fullpath)},icon:"glyphicon glyphicon-folder-open",isOpen:!0};var s=function(e){if(t.filemessage=null,t.filelist=[],0==e.children.length)t.filemessage={type:"info",text:"Folder empty"};else for(var a=0;a<e.children.length;a++)"DIRECTORY"==e.children[a].type?(e.children[a].icon="glyphicon glyphicon-folder-close folder-icon",e.children[a].loadChildren=function(){t.selectNode(this)}):(e.children[a].icon="glyphicon glyphicon-file file-icon",e.children[a].pathSuffix.lastIndexOf(".")>=0&&(e.children[a].fileExt=e.children[a].pathSuffix.split(".").pop(),e.children[a].icon+=" icon-"+e.children[a].fileExt)),t.filelist.push(e.children[a])},o=function(e,t){setTimeout(function(){var a=angular.element(document.querySelector("#"+t));console.log("element",t),angular.element(document.querySelector("#"+e))[0].scrollTop=a.prop("offsetTop"),console.log("parent",angular.element(document.querySelector("#"+e)))},0)},r=function(e){if(e.isOpen=!e.isOpen,t.pathToBrowse.length>0){e.isOpen=!0;var a=t.pathToBrowse[0];t.pathToBrowse.shift(),t.selectNode(d(e,a))}else o("folder-tree-panel",e.viewId),t.selectedFolderPath=e.fullpath,console.info("scope.pathToBrowse ",t.pathToBrowse),console.info("selectedFolderPath - ",t.selectedFolderPath)};t.selectNode=function(a){console.debug("fromNode",a),console.debug("fromPath",a.fullpath),console.log("qui"),0==a.children.length?e.getPath(a.fullpath).then(function(e){console.log("response",e.data.FileStatuses.FileStatus),t.list=e.data.FileStatuses.FileStatus;for(var n=0;n<e.data.FileStatuses.FileStatus.length;n++){var l=e.data.FileStatuses.FileStatus[n];l.fullpath=a.fullpath+l.pathSuffix,l.viewId=a.viewId+l.pathSuffix.replace(".","_")+"_","DIRECTORY"==l.type&&(l.fullpath+="/"),l.loadChildren=function(){t.selectNode(this)},l.children=[],a.children.push(l)}s(a),r(a)},function(e){console.error("getPath response error",e),t.filelist=[],t.filemessage={type:"danger",text:"<strong>"+e.status+"</strong> "+e.statusText},r(a)}):(s(a),r(a))};var d=function(e,t){console.log("parentNode",e,t),console.log("path",t);var a=null;if(e&&null!=e)for(var n=0;n<e.children.length;n++)if(e.children[n].pathSuffix==t){a=e.children[n];break}return a};t.browseToHome=function(){e.getHomeDirectory().then(function(e){console.log("response",e),null!=e&&null!=e.data&&null!=e.data.Path&&(t.pathToBrowse=e.data.Path.split("/"),t.pathToBrowse.shift(),t.selectNode(t.filetree))},function(e){console.error("browseToHome response error",e)})},t.browseToPath=function(e){t.pathToBrowse=e.split("/"),t.pathToBrowse.shift(),""==t.pathToBrowse[t.pathToBrowse.length-1]&&t.pathToBrowse.pop(),t.showFavoritePanel=!1,t.selectNode(t.filetree)},t.levelUp=function(e){e&&null!=e&&(e=e.substring(0,e.lastIndexOf("/")),e=e.substring(0,e.lastIndexOf("/")),t.browseToPath(e))},t.start=function(){t.selectNode(t.filetree),t.started=!0},t.start(),t.openFile=function(a){if(console.log("openFile",a),!a.fileExt||"jpg"!=a.fileExt&&"tiff"!=a.fileExt&&"gif"!=a.fileExt&&"bmp"!=a.fileExt&&"png"!=a.fileExt&&"jpeg"!=a.fileExt&&"ogg"!=a.fileExt&&"mp4"!=a.fileExt&&"webm"!=a.fileExt&&"mp3"!=a.fileExt&&"aac"!=a.fileExt)e.openFile(a.fullpath).then(function(e){console.log("response",e);var t=new Blob([e.data]),n=angular.element("<a></a>");n.attr("href",window.URL.createObjectURL(t)),n.attr("download",a.pathSuffix),n[0].click()},function(e){console.error("response error",e),t.message={type:"danger",title:"Unable to download the file",text:"<strong>"+e.status+"</strong> "+e.statusText}});else{var n=angular.element("<a></a>");n.attr("href",Constants.HDFS_BASE_URL+a.fullpath+"?op=OPEN"),n.attr("download",a.pathSuffix),n[0].click()}},t.imgFit=function(e){"width"==e?(t.imageFitWidth="100%",t.imageFitHeight="auto"):(t.imageFitWidth="auto",t.imageFitHeight="300px")},t.previewFile=function(a){if(t.imgPreviewUrl=null,!a.fileExt||"jpg"!=a.fileExt&&"tiff"!=a.fileExt&&"gif"!=a.fileExt&&"bmp"!=a.fileExt&&"png"!=a.fileExt&&"jpeg"!=a.fileExt)if(!a.fileExt||"ogg"!=a.fileExt&&"mp4"!=a.fileExt&&"webm"!=a.fileExt)if(!a.fileExt||"mp3"!=a.fileExt&&"aac"!=a.fileExt)e.previewFile(a.fullpath).then(function(e){console.log("response",e);var n="";if(a.fileExt&&"csv"==a.fileExt){n="<div class='preview-container'><table class='table table-condensed table-bordered table-preview'><tbody>";for(var l=e.data.match(/[^\r\n]+/g),i=0;i<l.length;i++){n+="<tr>";for(var s=l[i].split(","),o=0;o<s.length;o++)n+="<td>"+s[o]+"</td>";n+="</tr>"}n+="</tbody></table></div>"}else n="<p class='file-preview-body'>"+e.data+"</p>";t.modalPanelContent={title:"Preview of file "+a.pathSuffix,body:n}},function(e){console.error("response error",e),t.message={type:"danger",title:"Unable to create the file preview",text:"<strong>"+e.status+"</strong> "+e.statusText}});else{var n="<p class='file-preview-body'><audio width='320' height='240' controls><source src='"+Constants.HDFS_BASE_URL+a.fullpath+"?op=OPEN'></source></audio></p><p><strong>File name:</strong> "+a.pathSuffix+"</p>";t.modalPanelContent={title:"Preview of file "+a.pathSuffix,body:n}}else{var n="<p class='file-preview-body'><video width='320' height='240' controls><source src='"+Constants.HDFS_BASE_URL+a.fullpath+"?op=OPEN'></source></video></p><p><strong>File name:</strong> "+a.pathSuffix+"</p>";t.modalPanelContent={title:"Preview of file "+a.pathSuffix,body:n}}else t.imgPreviewUrl=Constants.HDFS_BASE_URL+a.fullpath+"?op=OPEN",t.modalPanelContent={title:"Preview of file "+a.pathSuffix,body:""}},t.logout=function(){e.logout().then(function(e){t.started=!1},function(e){console.error("response error",e),t.message={type:"danger",title:"Logout failed",text:"Unable to logout <strong>"+e.status+"</strong> "+e.statusText+"</br><p>Close the browser</p>"}})},t.refresh=function(){t.filetree.children=[],t.start()},t.supportsStorage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},t.favoritesPath=[],t.supportsStorage()&&(t.favoritesPath=JSON.parse(localStorage.getItem("favoritesPath")),"undefined"!=typeof t.favoritesPath&&null!=t.favoritesPath||(t.favoritesPath=[])),console.log("scope.favoritesPath",t.favoritesPath),t.addCurrentPathToFavorite=function(){t.selectedFolderPath,t.favoritesPath.indexOf(t.selectedFolderPath)<0&&(t.favoritesPath.push(t.selectedFolderPath),t.favoritesPath.sort(),localStorage.setItem("favoritesPath",JSON.stringify(t.favoritesPath)))},t.removeFavorite=function(e){var a=t.favoritesPath.indexOf(e);a>-1&&(t.favoritesPath.splice(a,1),localStorage.setItem("favoritesPath",JSON.stringify(t.favoritesPath)))},t.copyToClipboard=function(e){t.copyPanel.pathToCopy=e,setTimeout(function(){angular.element(document.querySelector("#copyToClipboardTextArea"))[0].select()},0)},t.selectedFolderPath="",t.filelist=[]}}}]),bigdataExplorerTemplatesModule.run(["$templateCache",function(e){e.put("template/hdfs-explorer.html",'<div class="explorer-header-toolbar clearfix" ng-show="started">\n  <div>\n     <div class="pull-left toolbar-panel"> \n       <a class="" href ng-click="refresh();"><i class="glyphicon glyphicon-refresh"></i> Refresh</a>\n       <a class="" ng-show="supportsStorage()" href ng-click="showFavoritePanel=true"><i class="glyphicon glyphicon-star"></i> Favorites</a> \n     </div>\n     <div class="pull-right">\n       <div><a class="" href ng-click="logout()"><i class="glyphicon glyphicon-log-out"></i> Logout</a></div>\n     </div>\n  </div>\n</div><div class="explorer-start-panel row" ng-show="!started">\n  <div class="col-sm-8  explorer-start-intro">\n    Insert user and password, or bind them using \n    <a href="http://zeppelin.apache.org/docs/0.6.1/displaysystem/front-end-angular.html" target="_blank"><code>z.angularBind</code></a> if you are using \n    <a hre="https://zeppelin.apache.org/" target="_blank"><strong>Apache Zeppelin</strong></a>\n  </div>\n</div>\n<div class="row explorer-wrapper" ng-show="started">\n  <div class="col-sm-8 col-sm-offset-4">\n    <p><a href ng-click="levelUp(selectedFolderPath)"><i class="glyphicon glyphicon-level-up level-up-icon" ng-show="selectedFolderPath!=\'/\'"></i></a> <strong translate>Full path</strong> <code>{{selectedFolderPath}}</code></p>\n  </div>\n  <div class="col-sm-4 folder-tree-panel" id="folder-tree-panel">\n     <a href ng-click="start()"  ng-class="filetree.fullpath == selectedFolderPath?\'folder-selected\':\'\'">\n  \t\t<i ng-class="filetree.icon" class="item-icon folder-icon"></i> {{filetree.pathSuffix}}<span ng-show="filetree.pathSuffix==\'\'">(root)</span>\n    </a> \n    <ul class="folder-tree-list"> \n      <li ng-repeat="folder in filetree.children | filter : {type: \'DIRECTORY\'} : true track by $index" ng-include="\'template/treefolder-view.html\'" ></li> \n    </ul> \n  </div>\n  <div class="col-sm-8 file-view-panel">\n\t <div class="alert alert-{{filemessage.type}}" role="alert" ng-show="filemessage!=null"><span ng-bind-html="filemessage.text"></span></div>\n    <table class="table table-striped table-condensed" ng-show="filelist.length>0">\n      <thead>\n        <tr><th>&nbsp;</th><th>Name</th><th>Update Date</th><th>Size</th><th>Owner</th><th>Group</th><th>Permission</th><th>Action</th></tr>\n      </thead>\n      <tbody>\n        <tr ng-repeat="file in filelist track by $index">\n \t\t\t<td><i class="{{file.icon}}"></i></td>\n           <td ng-show="file.type==\'DIRECTORY\'"><a href ng-click="file.loadChildren()">{{file.pathSuffix}}</a></td>\n           <td ng-show="file.type!=\'DIRECTORY\'">{{file.pathSuffix}}</td>\n           <td>{{file.modificationTime|date}}</td>\n           <td>{{file.length|format_filesize}}</td>\n           <td>{{file.owner}}</td>\n           <td>{{file.group}}</td>\n           <td>{{file.permission}}</td>\n           <td>\n               <a href ng-click="copyToClipboard(file.fullpath)" title="Copy full path: {{file.fullpath}}" class="file-action-button"><i class="glyphicon glyphicon-copy"></i></a>\n               <a ng-show="file.type!=\'DIRECTORY\'" href ng-click="openFile(file)" title="Open file" class="file-action-button"><i class="glyphicon glyphicon-save"></i></a>\n               <a ng-show="file.type!=\'DIRECTORY\'" href ng-click="previewFile(file)" title="Open file" class="file-action-button"><i class="glyphicon glyphicon-eye-open"></i></a>\n           </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</div>\n<div class="panel panel-{{message.type}} alert-main" ng-show="message!=null">\n  <div class="panel-heading">{{message.title}} <span class="close" ng-click="message = null">&times;</span></div>\n  <div class="panel-body"><p><span ng-bind-html="message.text"></span></p><div class="text-center"><a href ng-click="message = null" class="btn btn-default">Close</a></div></div>\n</div>\n<div class="panel panel-default modal-panel" ng-show="modalPanelContent!=null">\n  <div class="panel-heading">{{modalPanelContent.title}} <span class="close" ng-click="modalPanelContent = null">&times;</span></div>\n  <div class="panel-body">\n    <p ng-show="imgPreviewUrl!=null"><strong>Fit image </strong> \n       <a class="btn btn-default" href ng-click="imgFit(\'width\')"><i class="glyphicon glyphicon-resize-horizontal" alt="width"></i></a> \n       <a  class="btn btn-default" href ng-click="imgFit(\'height\')" alt="height"><i class="glyphicon glyphicon-resize-vertical"></i></a> \n    </p>    <p class="file-preview-body" ng-show="imgPreviewUrl!=null"><img src="{{imgPreviewUrl}}"  width="{{imageFitWidth}}" height="{{imageFitHeight}}"></img></p>\n    <div ng-bind-html="modalPanelContent.body"></div><div class="text-center"><a href ng-click="modalPanelContent = null" class="btn btn-default">Close</a></div>\n  </div>\n</div>\n</div>\n<div class="panel panel-default modal-panel" ng-show="copyPanel.pathToCopy!=null">\n  <div class="panel-heading">Copy full path<span class="close" ng-click="copyPanel.pathToCopy = null">&times;</span></div>\n  <div class="panel-body clipboard-copy-panel">\n    <p><textarea id="copyToClipboardTextArea" readonly >{{copyPanel.pathToCopy}}</textarea> </p>\n    <p><strong>Ctrl+C</strong> <small>to copy</small></p>\n    <div class="text-center"><a href ng-click="copyPanel.pathToCopy = null" class="btn btn-default">Close</a></div>\n </div>\n</div>\n<div class="panel panel-default modal-panel" ng-show="showFavoritePanel">\n  <div class="panel-heading"><i class="glyphicon glyphicon-star"></i> Favorites<span class="close" ng-click="showFavoritePanel=false">&times;</span></div>\n  <div class="panel-body ">\n    <p><ul class="list-group"><li class="list-group-item" ng-repeat="favorite in favoritesPath track by $index">\n        <a href ng-click="browseToPath(favorite)">{{favorite}}</a><a href ng-click="removeFavorite(favorite)" class="pull-right"><i class="glyphicon glyphicon-trash"></i></a>\n    </li></ul></p>\n    <p><a href ng-click="addCurrentPathToFavorite()" class="btn"><i class="glyphicon glyphicon-plus"></i> Add current path to favorite</a></p>\n  <div class="text-center"><a href ng-click="showFavoritePanel = false" class="btn btn-default">Close</a></div></div>\n</div>\n'),e.put("template/treefolder-view.html",'<a   id="{{folder.viewId}}" href ng-click="folder.loadChildren()" ng-class="folder.fullpath == selectedFolderPath?\'folder-selected\':\'\'">\n  <i ng-class="folder.isOpen?\'glyphicon glyphicon-folder-open\':\'glyphicon glyphicon-folder-close\'" class="item-icon folder-icon"></i> {{folder.pathSuffix}}\n</a> \n<ul class="folder-tree-list" ng-show="folder.isOpen"> \n   <li ng-repeat="folder in folder.children | filter : {type: \'DIRECTORY\'} : true track by $index" ng-include="\'template/treefolder-view.html\'">\n   </li>\n</ul> \n')}]),bigdataExplorerModule.directive("hiveExplorer",["hiveService","hdfsService","$bigdataExplorerHelpers",function(e,t,a){"use strict";return{restrict:"E",scope:{},templateUrl:"template/hive-explorer.html",link:function(a,n,l){console.debug("attrs",l),console.debug("hiveService",e.getInfo()),a.started=!1;var i=function(e,t,n){var l=null;return e==Constants.HIVE_NODE_TYPES.database.name?l=n:e==Constants.HIVE_NODE_TYPES.table.name&&(l=t.database),{viewId:t.viewId+n+"_",name:n,label:n,nodeType:e,children:[],loadChildren:function(){a.selectNode(this)},icon:Constants.HIVE_NODE_TYPES[e].icon,isOpen:!1,database:l,isLoading:!1}};a.tree=i("root","","root");var s=function(e){console.error("formatErrorMessage",e);var t="";return e.data&&null!=e.data&&e.data.error&&null!=e.data.error&&(t=e.data.error),{type:"danger",text:"<strong>"+e.status+" - "+e.statusText+"</strong> <p><span title='"+t+"'>"+t.substring(0,128)+"&hellip;</span></p>"}},o=function(t){console.debug("selectRoot",t),a.selectedNode=t,0==t.children.length&&(t.isLoading=!0,e.databaseList().then(function(e){console.log("databaseList",e),f(Constants.HIVE_NODE_TYPES.database.name,t,e.data.databases),t.isLoading=!1},function(e){t.isLoading=!1,t.message=s(e)})),t.detail||null!=t.detail||r(t)},r=function(t){t.detail={hadoop_version:"Loading...",hive_version:"Loading...",webhcat_version:"Loading...",webhcat_status:"Loading..."},e.systemWebhcatStatus().then(function(e){t.detail.webhcat_status=e.data.status,t.detail.webhcat_version=e.data.version},function(e){t.message=s(e)}),e.systemHiveVersion().then(function(e){t.detail.hive_version=e.data.version},function(e){t.message=s(e)}),e.systemHadoopVersion().then(function(e){t.detail.hadoop_version=e.data.version},function(e){t.message=s(e)})},d=function(t){console.debug("selectDatabase",t),a.selectedNode=t,0==t.children.length&&(t.isLoading=!0,e.tableList(t.name).then(function(e){console.log("tableList",e),f(Constants.HIVE_NODE_TYPES.table.name,t,e.data.tables),t.isLoading=!1},function(e){t.isLoading=!1,t.message=s(e)})),t.detail||null!=t.detail||c(t)},c=function(t){t.detail={isLoadingInfo:!0},e.databaseSingle(t.name).then(function(e){console.log("databaseSingle",e),t.detail.location="<code>"+e.data.location+"</code>",t.detail.owner=e.data.owner,t.detail.ownerType=e.data.ownerType,t.detail.isLoadingInfo=!1},function(e){t.detail="Error",t.message=s(e)})},p=function(e){console.debug("selectDatabase",e),a.selectedNode=e,e.detail||null!=e.detail||g(e)},u=(new Date).getTime(),g=function(t){var a=(new Date).getTime();t.detail={table:t.name,database:t.database,columns:[],isLoadingColumns:!0,isLoadingProperties:!0,properties:{numFiles:"-",transient_lastDdlTime:"-",COLUMN_STATS_ACCURATE:"-",EXTERNAL:"-",totalSize:"-",numRows:"-",rawDataSize:"-",partitions:"-"},preview:{isQueryRunning:!1,jobStatus:null,jobComplete:!1,jobStartTime:null,query:"select * from "+t.database+"."+t.name+" limit 100",previewData:null,previewDataHeader:null,jobId:null,outputName:"Bde_"+t.database+"_"+t.name+"_"+a+".output"}},t.message=null,t.detail.isLoadingColumns=!0,e.tableSingle(t.database,t.name).then(function(e){console.log("tableSingle",e),t.detail.columns=e.data.columns,t.detail.isLoadingColumns=!1,null!=t.detail.columns&&0!=t.detail.columns.length||(t.detail.tableColumnMessage={type:"info",text:"This table has no columns"})},function(e){t.detail.tableColumnMessage=s(e)}),e.tableSingleProperties(t.database,t.name).then(function(e){console.log("tableSingleProperties",e),t.detail.properties.numFiles=e.data.properties.numFiles,t.detail.properties.transient_lastDdlTime=e.data.properties.transient_lastDdlTime,t.detail.properties.COLUMN_STATS_ACCURATE=e.data.properties.COLUMN_STATS_ACCURATE,t.detail.properties.EXTERNAL=e.data.properties.EXTERNAL,t.detail.properties.totalSize=e.data.properties.totalSize,t.detail.properties.numRows=e.data.properties.numRows,t.detail.properties.rawDataSize=e.data.properties.rawDataSize,t.detail.properties.partitions=e.data.properties.partitions,t.detail.isLoadingProperties=!1,console.log("node.detail.properties",t.detail.properties)},function(e){t.detail.tablePropertiesMessage=s(e)})},h=function(e){for(var t=!1,a=e.split(/\s+/),n=0;n<a.length;n++)if("limit"==a[n]||"LIMIT"==a[n]||"Limit"==a[n])try{var l=parseInt(a[n+1]);if(l>0&&l<101){t=!0;break}}catch(e){t=!1}return t};a.runPreviewQuery=function(){console.debug("runPreviewQuery",a.selectedNode.detail.preview),console.log("limit",a.selectedNode.detail.preview.query.indexOf("limit")),a.selectedNode.detail.tablePreviewMessage=null,""==a.selectedNode.detail.preview.query?selectedNode.detail.tablePreviewMessage={type:"warning",title:"Invalid query",text:"Enter a query"}:a.selectedNode.detail.preview.query.indexOf("limit")==-1?a.selectedNode.detail.tablePreviewMessage={type:"warning",title:"Invalid query",text:"A <strong>limit clause</strong> is required (e.g select * from table limit 100). <strong>Max</strong> limit accepted <strong>100</strong> rows"}:h(a.selectedNode.detail.preview.query)?(a.selectedNode.detail.preview.isQueryRunning=!0,a.selectedNode.detail.preview.jobStatus="LAUNCHED",e.runQueryPreview(a.selectedNode.detail.preview.query,a.selectedNode.detail.preview.outputName).then(function(e){console.log("runPreviewQuery response",e),a.selectedNode.detail.preview.isQueryRunning=!1,a.selectedNode.detail.preview.jobId=e.data.id},function(e){a.selectedNode.detail.tablePreviewMessage=s(e),a.selectedNode.detail.preview.isQueryRunning=!1,a.selectedNode.detail.preview.isJobRunning=!1})):a.selectedNode.detail.tablePreviewMessage={type:"warning",title:"Invalid query",text:"The max limit accepted is 100 rows"}},a.checkPreview=function(){console.debug("checkPreview",a.selectedNode.detail.preview.query),a.selectedNode.detail.preview.jobLastCheck=(new Date).getTime(),e.jobSingle(a.selectedNode.detail.preview.jobId).then(function(e){if(console.log("jobSingle",e),a.selectedNode.detail.preview.jobStatus=e.data.status.state,a.selectedNode.detail.preview.jobComplete=e.data.status.jobComplete,a.selectedNode.detail.preview.jobStartTime=e.data.status.startTime,"SUCCEEDED"==a.selectedNode.detail.preview.jobStatus){var n="/user/"+e.data.user+"/"+a.selectedNode.detail.preview.outputName+"/stdout";console.log("previewPath",n),t.previewFile(n).then(function(e){console.log("response",e);var t=e.data.match(/[^\r\n]+/g);if(a.selectedNode.detail.preview.previewData=[],t&&t.length>1){a.selectedNode.detail.preview.previewDataHeader=t[0].split("\t");for(var n=1;n<t.length;n++)a.selectedNode.detail.preview.previewData.push(t[n].split("\t"))}},function(e){console.error("response error",e),a.message={type:"danger",title:"Unable to create the file preview",text:"<strong>"+e.status+"</strong> "+e.statusText}})}else if("FAILED"==a.selectedNode.detail.preview.jobStatus){var l="/user/"+e.data.user+"/"+a.selectedNode.detail.preview.outputName+"/stderr";t.previewFile(l).then(function(e){console.error("response error",e),a.selectedNode.detail.preview.errorLog=e.data},function(e){console.error("response error",e),a.message={type:"danger",title:"Unable to load error log",text:"<p>Error log path: <code>/user/sdp/ale3.output/stderr</code></p><strong>"+e.status+"</strong> "+e.statusText}})}},function(e){selectedNode.detail.tablePropertiesMessage=s(e)})},a.newPreviewQuery=function(){a.selectedNode.detail.preview.isQueryRunning=!1,a.selectedNode.detail.preview.jobStatus=null,a.selectedNode.detail.preview.jobComplete=!1,a.selectedNode.detail.preview.jobStartTime=null,a.selectedNode.detail.preview.query="select * from "+node.database+"."+node.name+" limit 100",a.selectedNode.detail.preview.previewData=null,a.selectedNode.detail.preview.previewDataHeader=null,a.selectedNode.detail.preview.jobId=null,a.selectedNode.detail.preview.outputName="Bde_"+node.database+"_"+node.name+"_"+u+".output"};var f=function(e,t,n){for(var l=0;l<n.length;l++)t.children.push(i(e,t,n[l]));console.log("addChilds",a.tree)};a.selectNode=function(e){console.debug("fromNode",e),e.isOpen=!e.isOpen,e.nodeType==Constants.HIVE_NODE_TYPES.root.name?o(e):e.nodeType==Constants.HIVE_NODE_TYPES.database.name?d(e):e.nodeType==Constants.HIVE_NODE_TYPES.table.name&&p(e)},a.start=function(){a.selectNode(a.tree),a.started=!0},a.start(),a.logout=function(){e.logout().then(function(e){a.started=!1},function(e){console.error("response error",e),a.message={type:"danger",title:"Logout failed",text:"Unable to logout <strong>"+e.status+"</strong> "+e.statusText+"</br><p>Close the browser</p>"}})},a.refresh=function(){a.tree.children=[],a.start()}}}}]),bigdataExplorerTemplatesModule.run(["$templateCache",function(e){e.put("template/hive-explorer.html",'<div class="explorer-header-toolbar clearfix" ng-show="started">\n  <div>\n     <div class="pull-left toolbar-panel"> \n       <a class="" href ng-click="refresh();"><i class="glyphicon glyphicon-refresh"></i> Refresh</a>\n     </div>\n     <div class="pull-right">\n       <div><a class="" href ng-click="logout()"><i class="glyphicon glyphicon-log-out"></i> Logout</a></div>\n     </div>\n  </div>\n</div><div class="explorer-start-panel row" ng-show="!started">\n  <div class="col-sm-8  explorer-start-intro">\n    Insert user and password, or bind them using \n    <a href="http://zeppelin.apache.org/docs/0.6.1/displaysystem/front-end-angular.html" target="_blank"><code>z.angularBind</code></a> if you are using \n    <a hre="https://zeppelin.apache.org/" target="_blank"><strong>Apache Zeppelin</strong></a>\n  </div>\n</div>\n<div class="row explorer-wrapper" ng-show="started">\n  <div class="col-sm-8 col-sm-offset-4">\n    <p> \n      <span ng-show="selectedNode.database!=null" class="hive-breadcumb-item"><i class="icon icon-database"></i> {{selectedNode.database}}</span> \n      <span ng-show="selectedNode.nodeType == \'table\'" class="hive-breadcumb-item"><i class="icon icon-table"></i> {{selectedNode.name}}</span> \n    </p>\n  </div>\n  <div class="col-sm-4 hive-tree-panel" id="hive-tree-panel">\n     <a href ng-click="start()">\n  \t\t<i ng-class="tree.icon" class="item-icon"></i> {{tree.label}}\n    </a> \n    <div class="spinner" ng-show="tree.isLoading">Loading databases&hellip; &nbsp;&nbsp;<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>    \n    <ul class="hive-tree-list"> \n      <li ng-repeat="child in tree.children track by $index" ng-include="\'template/hive-tree-view.html\'" ></li> \n    </ul> \n  </div>\n  <div class="col-sm-8 view-panel">\n\t <div class="alert alert-{{selectedNode.message.type}}" role="alert" ng-show="selectedNode.message!=null"><span ng-bind-html="selectedNode.message.text"></span></div>\n    <div id="hive-system-info" ng-show="selectedNode.nodeType == \'root\'"> \n \t\t<h1 class="title-icon">System Info</h1>\t\n    \t<table class="table hive-system-info-table" >\n         <tbody>\n          <tr><td><i class="icon icon-hadoop"></i><td><strong>Hadoop</strong></td><td>Version</td><td>{{selectedNode.detail.hadoop_version}}</td></tr>\n          <tr><td><i class="icon icon-hive"></i><td><strong>Hive</strong></td><td>Version</td><td>{{selectedNode.detail.hive_version}}</td></tr>\n          <tr><td rowspan="2"><i class="icon icon-webhcat"></i></td><td rowspan="2"><strong>WebHCat</strong></td><td>Version</td><td>{{selectedNode.detail.webhcat_version}}</td></tr>\n          <tr><td>Status</td><td>{{selectedNode.detail.webhcat_status}}</td></tr>\n        </tbody>\n      </table>\n    </div>\n    <div id="hive-database-detail" ng-show="selectedNode.nodeType == \'database\'"> \n \t\t<h2 class="title-icon"><i class="icon icon-database"></i>Database <strong>{{selectedNode.name}}</strong></h2>\t\n       <div class="spinner" ng-show="selectedNode.detail.isLoadingInfo">Loading info&hellip; &nbsp;&nbsp;<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>    \n    \t<table class="table" ng-show="!selectedNode.detail.isLoadingInfo && selectedNode.detail!=null">\n         <tbody>\n          <tr><td><strong>Location</td><td><span ng-bind-html="selectedNode.detail.location"></span></td></tr>\n          <tr><td><strong>Owner</td><td><span ng-bind-html="selectedNode.detail.owner"></span></td></tr>\n          <tr><td><strong>Owner Type</td><td><span ng-bind-html="selectedNode.detail.ownerType"></span></td></tr>\n        </tbody>\n      </table>\n    </div>\n    <div id="hive-table-detail" ng-show="selectedNode.nodeType == \'table\'"> \n \t\t<h2 class="title-icon"><i class="icon icon-table"></i> Table <strong>{{selectedNode.name}}</strong> </h2>\t\n       <ul class="clearfix tab-bar nav nav-tabs" ng-init="currentTableDetailTab=\'tableStructure\'">\n         <li class="tab-item" ng-class="currentTableDetailTab == \'tableStructure\'?\'active\':\'\'"><a href ng-click="currentTableDetailTab=\'tableStructure\'">Structure</a></li>\n         <li class="tab-item" ng-class="currentTableDetailTab == \'tableProperties\'?\'active\':\'\'"><a href ng-click="currentTableDetailTab=\'tableProperties\'">Properties</a></li>\n         <li class="tab-item" ng-class="currentTableDetailTab == \'tablePreview\'?\'active\':\'\'"><a href ng-click="currentTableDetailTab=\'tablePreview\'">Data preview</a></li>\n       </ul>\n       <div class="tab-panel" ng-show="currentTableDetailTab==\'tableStructure\'" >\n\t      <div class="alert alert-{{selectedNode.detail.tableColumnMessage.type}}" role="alert" ng-show="selectedNode.detail.tableColumnMessage!=null"><span ng-bind-html="selectedNode.detail.tableColumnMessage.text"></span></div>\n         <div class="spinner" ng-show="selectedNode.detail.isLoadingColumns">Loading columns&hellip; &nbsp;&nbsp;<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>    \n    \t  <table class="table" ng-show="selectedNode.detail.columns.length>0">\n           <thead>\n             <tr><th class="text-muted">#</th><th>Name</th><th>Type</th></tr>\n           </thead>\n           <tbody>\n             <tr ng-repeat="col in selectedNode.detail.columns track by $index"><td class="text-muted">{{$index+1}}</td><td><strong>{{col.name}}</strong></td><td>{{col.type}}</td></tr>\n           </tbody>\n         </table>\n       </div>\n       <div class="tab-panel" ng-show="currentTableDetailTab==\'tableProperties\'" >\n\t      <div class="alert alert-{{selectedNode.detail.tablePropertiesMessage.type}}" role="alert" ng-show="selectedNode.detail.tablePropertiesMessage!=null"><span ng-bind-html="selectedNode.detail.tablePropertiesMessage.text"></span></div>\n         <div class="spinner" ng-show="selectedNode.detail.isLoadingProperties">Loading properties&hellip; &nbsp;&nbsp;<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>    \n    \t  <table class="table" ng-show="!selectedNode.detail.isLoadingProperties">\n           <tbody>\n             <tr><td><strong>numFiles</strong></td><td>{{selectedNode.detail.properties.numFiles}}</td></tr>\n             <tr><td><strong>transient_lastDdlTime</strong></td><td>{{selectedNode.detail.properties.transient_lastDdlTime*1000|date:"dd/MM/yyyy H:mm:ss"}}</td></tr>\n             <tr><td><strong>COLUMN_STATS_ACCURATE</strong></td><td>{{selectedNode.detail.properties.COLUMN_STATS_ACCURATE}}</td></tr>\n             <tr><td><strong>EXTERNAL</strong></td><td>{{selectedNode.detail.properties.EXTERNAL}}</td></tr>\n             <tr><td><strong>totalSize</strong></td><td>{{selectedNode.detail.properties.totalSize|format_filesize}}</td></tr>\n             <tr><td><strong>numRows</strong></td><td>{{selectedNode.detail.properties.numRows}}</td></tr>\n             <tr><td><strong>numCols</strong></td><td><span ng-show="selectedNode.detail.columns.length>0">{{selectedNode.detail.columns.length}}</span></td></tr>\n             <tr><td><strong>rawDataSize</strong></td><td>{{selectedNode.detail.properties.rawDataSize|format_filesize}}</td></tr>\n             <tr><td><strong>partitions</strong></td><td>{{selectedNode.detail.properties.partitions}}</td></tr>\n           </tbody>\n         </table>\n       </div>\n       <div class="tab-panel hive-query-preview-tab" ng-show="currentTableDetailTab==\'tablePreview\'">\n\t      <div class="alert alert-{{selectedNode.detail.tablePreviewMessage.type}}" role="alert" ng-show="selectedNode.detail.tablePreviewMessage!=null"><span ng-bind-html="selectedNode.detail.tablePreviewMessage.text"></span></div>\n\t      <form class="form-horizontal" ng-show="selectedNode.detail.preview.jobStatus==null" ng-submit="runPreviewQuery()">\n\t        <div class="form-group">\n\t          <label for="previewQueryInput" class="col-sm-2 control-label">Query</label>\n\t          <div class="col-sm-8"><input readonly type="text" class="form-control" id="previewQueryInput" placeholder="e.g select * from database.table" ng-model="selectedNode.detail.preview.query"></div>\n\t          <div class="col-sm-2"><button type="submit" class="btn btn-default" >Run query</button></div>\n\t        </div>\n\t      </form>\n         <div ng-show="selectedNode.detail.preview.jobStatus!=null">\n           <p>Query <code>{{selectedNode.detail.preview.query}}</code></p>\n           <div class="spinner" ng-show="selectedNode.detail.preview.isQueryRunning">Query launched&hellip; &nbsp;&nbsp;<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>\n           <p ng-show="!selectedNode.detail.preview.isQueryRunning"> \n              <span><strong>Job</strong> {{selectedNode.detail.preview.jobId}}&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;\n              <strong>Status</strong> <span class="hive-job-status-{{selectedNode.detail.preview.jobStatus}}">{{selectedNode.detail.preview.jobStatus}}</span> &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;\n              <strong>Start time</strong> {{selectedNode.detail.preview.jobStartTime|date:"dd/MM/yyyy HH:mm:ss"}}</span> \n           </p>\n           <p ng-show="!selectedNode.detail.preview.jobComplete"> \n             The job is running, it may take several seconds to finish. \n             <a class="btn btn-default" href ng-click="checkPreview()" ng-show="!selectedNode.detail.preview.isQueryRunning && !selectedNode.detail.preview.jobComplete">Check if it finished</a> \n              &nbsp;&nbsp;&nbsp;<span class="text-muted" ng-show="selectedNode.detail.preview.jobLastCheck!=null">\n              Last check {{selectedNode.detail.preview.jobLastCheck|date:"dd/MM/yyyy HH:mm:ss"}}</span>           </p>\n           <div ng-show="selectedNode.detail.preview.jobComplete">\n             <div ng-show="selectedNode.detail.preview.jobStatus==\'SUCCEEDED\'">               <div ng-show="selectedNode.detail.preview.previewData.length==0">The query did not return rows</div>\n               <div ng-show="selectedNode.detail.preview.previewData.length>0" class="hive-preview-table">                 <table class="table table-condensed table-bordered table-preview">\t\t\t\t\t<thead><tr><th>&nbsp;</th><th ng-repeat="cell in selectedNode.detail.preview.previewDataHeader track by $index">{{cell}}</th></tr></thead>\t\t\t\t\t<tbody><tr ng-repeat="row in selectedNode.detail.preview.previewData track by $index"><td class="row-num">{{$index+1}}</td><td ng-repeat="cell in row track by $index" title="{{cell}}">{{cell|string_ellipse:40}}</td></tr></tbody>                 </table>               </div>\n             </div>             <div ng-show="selectedNode.detail.preview.jobStatus==\'FAILED\'">             \t<div class="panel panel-danger panel-scroll"><div class="panel-heading">Job failed</div> \n                 <div class="panel-body" ng-bind-html="selectedNode.detail.preview.errorLog"></div>\n                 </div>             </div>             <p class="text-right"> <a class="btn btn-default" href ng-click="newPreviewQuery()">Run an other preview query </a></p>           </div>         </div>      </div>\n    </div>\n  </div>\n</div>\n<div class="panel panel-{{message.type}} alert-main" ng-show="message!=null">\n  <div class="panel-heading">{{message.title}} <span class="close" ng-click="message = null">&times;</span></div>\n  <div class="panel-body"><p><span ng-bind-html="message.text"></span></p><div class="text-center"><a href ng-click="message = null" class="btn btn-default">Close</a></div></div>\n</div>\n'),
e.put("template/hive-tree-view.html",'<a   id="{{child.viewId}}" href ng-click="child.loadChildren()" ng-class="selectedNode.name == child.name?\'hive-tree-item-selected\':\'\'">\n  <i class="{{child.icon}}"></i> {{child.label}}\n</a> \n<div class="spinner" ng-show="child.isLoading">Loading tables&hellip; &nbsp;&nbsp;<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>    \n<ul class="hive-tree-list" ng-show="child.isOpen"> \n   <li ng-repeat="child in child.children track by $index" ng-include="\'template/hive-tree-view.html\'">\n   </li>\n</ul> \n')}]);